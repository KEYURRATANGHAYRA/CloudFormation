{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "AWS CloudFormation for Generic Cloudsuite for WFM 6.1.5 with Amazon RHEL 6.4 AMIs : CF Template showing how to create a multi-tier web application in a VPC with multiple subnets. The first subnet is public and contains and internet facing NAT, NAT device for internet access from the private2 subnet and aDB in the private subnet and Weblogic and Apache webserver EC2 instances in another private1 subnet. **WARNING** This template creates  Amazon EC2 instances. You will be billed for the AWS resources used if you create a stack from this template.",
    "Parameters": {
        "KeyName": {
            "Description": "Name of an existing EC2 KeyPair to enable SSH access to the instances",
            "Type": "String",
            "MinLength": "1",
            "MaxLength": "64",
            "Default": "InforBusinessCloud",
            "AllowedPattern": "[-_ a-zA-Z0-9]*",
            "ConstraintDescription": "Can contain only alphanumeric characters, spaces, dashes and underscores."
        },
        "prefix": {
            "Type": "String",
            "Default": "cs-wfm-00-prd",
            "Description": "Customer Prefix and it is Mandatory field"
        },
        "shortName": {
            "Type": "String",
            "Default": "wfm",
            "Description": "Customer shortName and it is Mandatory field"
        },
        "dbsid": {
            "Type": "String",
            "Default": "dbsid",
            "Description": "Customer dbsid and it is Mandatory field"
        },
        "envType": {
            "Type": "String",
            "Default": "prd",
            "Description": "env Type and it is Mandatory field"
        },
        "availabilityZone1": {
            "Type": "String",
            "Default": "eu-west-1b",
            "Description": "availabilityZone1"
        },
        "TerminationONOFF": {
            "Type": "String",
            "Description": "Specifies whether the instance can be terminated through the API",
            "Default": "false"
        },
        "version": {
            "Type": "String",
            "Default": "1.2",
            "Description": "Customer Prefix and it is Mandatory field"
        },
        "contactGrp": {
            "Type": "String",
            "Default": "ams-cloud-support",
            "Description": "Nagios Monitoring Contract Group ams-cloud-support"
        },
        "cloudsuiteMailsender": {
            "Type": "String",
            "Default": "cloudsuite-notifications@infor.com",
            "Description": "Cloud Suite Notification Mail Sender Email ID"
        },
        "HostedZone": {
            "Type": "String",
            "Default": "cloud.infor.com",
            "Description": "The DNS name of an existing Amazon Route 53 hosted zone"
        },
        "DomainName": {
            "Type": "String",
            "Default": "inforbc.com",
            "Description": "The DNS name"
        },
        "DomainDNSName": {
            "Description": "Fully qualified domain name (FQDN) of the forest root domain e.g. corp.example.com",
            "Type": "String",
            "MinLength": "3",
            "MaxLength": "25",
            "Default": "inforbc.com",
            "AllowedPattern": "[a-zA-Z0-9]+\\..+"
        },
        "DomainNetBIOSName": {
            "Description": "NetBIOS name of the domain (upto 15 characters) for users of earlier versions of Windows e.g. CORP",
            "Type": "String",
            "MinLength": "1",
            "MaxLength": "15",
            "Default": "INFORBC",
            "AllowedPattern": "[a-zA-Z0-9]+"
        },
        "RestoreModePassword": {
            "Description": "Password for a separate Administrator account when the domain controller is in Restore Mode. Must be at least 8 characters containing letters, numbers and symbols",
            "Type": "String",
            "MinLength": "8",
            "MaxLength": "32",
            "Default": "xxxXXXXX",
            "AllowedPattern": "(?=^.{6,255}$)((?=.*\\d)(?=.*[A-Z])(?=.*[a-z])|(?=.*\\d)(?=.*[^A-Za-z0-9])(?=.*[a-z])|(?=.*[^A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z])|(?=.*\\d)(?=.*[A-Z])(?=.*[^A-Za-z0-9]))^.*",
            "NoEcho": "True"
        },
        "VPCCIDR": {
            "Description": "Lockdown SSH access to the bastion host (default can be accessed from anywhere)",
            "Type": "String",
            "MinLength": "3",
            "MaxLength": "18",
            "Default": "172.19",
            "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})",
            "ConstraintDescription": "must be a valid CIDR range of the form x.x"
        },
        "NATInstanceType": {
            "Description": "NAT Device EC2 instance type",
            "Type": "String",
            "Default": "m3.medium",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCADM01Type": {
            "Description": "Admin EC2 instance type",
            "Type": "String",
            "Default": "m3.medium",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCDB01Type": {
            "Description": "Database Server EC2 instance type",
            "Type": "String",
            "Default": "m4.xlarge",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCWS01Type": {
            "Description": "Apache Web Server 1 EC2 instance type",
            "Type": "String",
            "Default": "m3.medium",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCWS02Type": {
            "Description": "Apache Web Server 2 EC2 instance type",
            "Type": "String",
            "Default": "m3.medium",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCWL01Type": {
            "Description": "WebLogic  Server 1 EC2 instance type",
            "Type": "String",
            "Default": "m4.xlarge",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCWL02Type": {
            "Description": "WebLogic Server 2 EC2 instance type",
            "Type": "String",
            "Default": "m4.xlarge",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCDA01Type": {
            "Description": "Dash  Server EC2 instance type",
            "Type": "String",
            "Default": "m4.large",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCJB01Type": {
            "Description": "Job Scheduler Server EC2 instance type",
            "Type": "String",
            "Default": "m4.large",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCJMP01Type": {
            "Description": "Job Scheduler Server EC2 instance type",
            "Type": "String",
            "Default": "m3.medium",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "INFORBCIR01Type": {
            "Description": "Reporting server instance type",
            "Type": "String",
            "Default": "m4.xlarge",
            "ConstraintDescription": "must be a valid EC2 instance type."
        },
        "regionalCloudsuiteBucket": {
            "Type": "String",
            "Default": "infor-cs-euw1-0bf4216f-97a9-4b78-b3d4-d43113502a5f",
            "Description": "Cloud suite protal will pass ELB S3 bucket name value as input regionalCloudsuiteBucket"
        },
        "monitoringType": {
            "Type": "String",
            "Default": "test",
            "Description": "Type of monitoring"
        }
    },
    "Conditions": {
        "azcond": {
            "Fn::Equals": [
                {
                    "Ref": "availabilityZone1"
                },
                {
                    "Fn::Select": [
                        "0",
                        {
                            "Fn::GetAZs": {
                                "Ref": "AWS::Region"
                            }
                        }
                    ]
                }
            ]
        }
    },
    "Mappings": {
        "INFORBCNT01": {
            "us-east-1": {
                "AMI": "ami-d4dc63bc"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-fa2d808d"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCWS01": {
            "us-east-1": {
                "AMI": "ami-07207262"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-dda59caa"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCWS02": {
            "us-east-1": {
                "AMI": "ami-07207262"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-dda59caa"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCWL01": {
            "us-east-1": {
                "AMI": "ami-07207262"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-dda59caa"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCWL02": {
            "us-east-1": {
                "AMI": "ami-07207262"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-dda59caa"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCIR01": {
            "us-east-1": {
                "AMI": "ami-07207262"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-dda59caa"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCJB01": {
            "us-east-1": {
                "AMI": "ami-07207262"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-dda59caa"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCDA01": {
            "us-east-1": {
                "AMI": "ami-07207262"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-dda59caa"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCADM01": {
            "us-east-1": {
                "AMI": "ami-5b24763e"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-43af9634"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCDB01": {
            "us-east-1": {
                "AMI": "ami-37277552"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-69a1981e"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "INFORBCJMP01": {
            "us-east-1": {
                "AMI": "ami-d5fbbfb0"
            },
            "us-west-1": {
                "AMI": ""
            },
            "us-west-2": {
                "AMI": ""
            },
            "eu-west-1": {
                "AMI": "ami-598a552a"
            },
            "eu-central-1": {
                "AMI": ""
            },
            "sa-east-1": {
                "AMI": ""
            },
            "ap-southeast-1": {
                "AMI": ""
            },
            "ap-southeast-2": {
                "AMI": ""
            },
            "ap-northeast-1": {
                "AMI": ""
            }
        },
        "PrivateIp": {
            "NAT": {
                "Address": "172.19.20.34"
            },
            "WL1": {
                "Address": "172.19.8.11"
            },
            "ADM": {
                "Address": "172.19.20.36"
            },
            "DB": {
                "Address": "172.19.10.11"
            },
            "WL2": {
                "Address": "172.19.9.11"
            },
            "WS1": {
                "Address": "172.19.8.10"
            },
            "WS2": {
                "Address": "172.19.9.10"
            },
            "IR": {
                "Address": "172.19.8.12"
            },
            "DASH": {
                "Address": "172.19.8.13"
            },
            "JMP": {
                "Address": "172.19.11.10"
            },
            "JB": {
                "Address": "172.19.20.35"
            }
        },
        "SubnetConfig": {
            "VPC": {
                "CIDR": "172.19.0.0/16"
            },
            "Public": {
                "CIDR": "172.19.20.0/24"
            },
            "Private1": {
                "CIDR": "172.19.8.0/24"
            },
            "Private2": {
                "CIDR": "172.19.9.0/24"
            },
            "Private3": {
                "CIDR": "172.19.10.0/24"
            },
            "Private4": {
                "CIDR": "172.19.11.0/24"
            },
            "Nagios": {
                "CIDR": "54.194.222.179/32"
            }
        }
    },
    "Resources": {
        "VPC": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": {
                    "Fn::FindInMap": [
                        "SubnetConfig",
                        "VPC",
                        "CIDR"
                    ]
                },
                "EnableDnsSupport": true,
                "EnableDnsHostnames": true,
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-VPC"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    }
                ]
            }
        },
        "PublicSubnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Ref": "availabilityZone1"
                },
                "CidrBlock": {
                    "Fn::FindInMap": [
                        "SubnetConfig",
                        "Public",
                        "CIDR"
                    ]
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-PublicSubnet"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    }
                ]
            }
        },
        "InternetGateway": {
            "Type": "AWS::EC2::InternetGateway",
            "Properties": {
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-InternetGateway"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    }
                ]
            }
        },
        "GatewayToInternet": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "DependsOn": "VPC",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "InternetGatewayId": {
                    "Ref": "InternetGateway"
                }
            }
        },
        "PublicRouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-PublicRouteTable"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Public"
                    }
                ]
            }
        },
        "PublicRoute": {
            "Type": "AWS::EC2::Route",
            "DependsOn": "GatewayToInternet",
            "Properties": {
                "RouteTableId": {
                    "Ref": "PublicRouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "GatewayId": {
                    "Ref": "InternetGateway"
                }
            }
        },
        "PublicSubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "PublicSubnet"
                },
                "RouteTableId": {
                    "Ref": "PublicRouteTable"
                }
            }
        },
        "DhcpOptions": {
            "Type": "AWS::EC2::DHCPOptions",
            "Properties": {
                "DomainName": {
                    "Ref": "DomainName"
                },
                "DomainNameServers": [
                    "172.19.0.2"
                ],
                "NetbiosNameServers": [
                    "172.19.0.2"
                ],
                "NetbiosNodeType": 2
            }
        },
        "VPCDHCPOptionAssociation": {
            "Type": "AWS::EC2::VPCDHCPOptionsAssociation",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "DhcpOptionsId": {
                    "Ref": "DhcpOptions"
                }
            },
            "DependsOn": "DhcpOptions"
        },
        "Private1Subnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Ref": "availabilityZone1"
                },
                "CidrBlock": {
                    "Fn::FindInMap": [
                        "SubnetConfig",
                        "Private1",
                        "CIDR"
                    ]
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-Private1Subnet"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private1"
                    }
                ]
            }
        },
        "Private1RouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private1"
                    }
                ]
            }
        },
        "Private1SubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "Private1Subnet"
                },
                "RouteTableId": {
                    "Ref": "Private1RouteTable"
                }
            }
        },
        "Private1Route": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "Private1RouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "InstanceId": {
                    "Ref": "NATDevice"
                }
            }
        },
        "Private2Subnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Fn::If": [
                        "azcond",
                        {
                            "Fn::Select": [
                                "1",
                                {
                                    "Fn::GetAZs": {
                                        "Ref": "AWS::Region"
                                    }
                                }
                            ]
                        },
                        {
                            "Fn::Select": [
                                "0",
                                {
                                    "Fn::GetAZs": {
                                        "Ref": "AWS::Region"
                                    }
                                }
                            ]
                        }
                    ]
                },
                "CidrBlock": {
                    "Fn::FindInMap": [
                        "SubnetConfig",
                        "Private2",
                        "CIDR"
                    ]
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-Private2Subnet"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private2"
                    }
                ]
            }
        },
        "Private2RouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-PrivateRouteTable"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private2"
                    }
                ]
            }
        },
        "Private2SubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "Private2Subnet"
                },
                "RouteTableId": {
                    "Ref": "Private2RouteTable"
                }
            }
        },
        "Private2Route": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "Private2RouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "InstanceId": {
                    "Ref": "NATDevice"
                }
            }
        },
        "Private3Subnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Ref": "availabilityZone1"
                },
                "CidrBlock": {
                    "Fn::FindInMap": [
                        "SubnetConfig",
                        "Private3",
                        "CIDR"
                    ]
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-Private3Subnet"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private3"
                    }
                ]
            }
        },
        "Private3RouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private3"
                    }
                ]
            }
        },
        "Private3SubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "Private3Subnet"
                },
                "RouteTableId": {
                    "Ref": "Private3RouteTable"
                }
            }
        },
        "Private3Route": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "Private3RouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "InstanceId": {
                    "Ref": "NATDevice"
                }
            }
        },
        "Private4Subnet": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Ref": "availabilityZone1"
                },
                "CidrBlock": {
                    "Fn::FindInMap": [
                        "SubnetConfig",
                        "Private4",
                        "CIDR"
                    ]
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-Private4Subnet"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private4"
                    }
                ]
            }
        },
        "Private4RouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-Private4RouteTable"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "Network",
                        "Value": "Private4"
                    }
                ]
            }
        },
        "Private4SubnetRouteTableAssociation": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "Private4Subnet"
                },
                "RouteTableId": {
                    "Ref": "Private4RouteTable"
                }
            }
        },
        "Private4Route": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "RouteTableId": {
                    "Ref": "Private4RouteTable"
                },
                "DestinationCidrBlock": "0.0.0.0/0",
                "InstanceId": {
                    "Ref": "NATDevice"
                }
            }
        },
        "DMZNetworkAcl": {
            "Type": "AWS::EC2::NetworkAcl",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-NetworkAcl"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ]
            }
        },
        "INDMZNetworkAclEntry160": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "160",
                "Protocol": "1",
                "RuleAction": "allow",
                "Egress": "false",
                "CidrBlock": "0.0.0.0/0",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "-1",
                    "To": "-1"
                }
            }
        },
        "INDMZNetworkAclEntry170": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "170",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "false",
                "CidrBlock": "172.19.0.0/16",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "3389",
                    "To": "3389"
                }
            }
        },
        "INDMZNetworkAclEntry150": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "150",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "false",
                "CidrBlock": "172.19.11.10/32",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "1521",
                    "To": "1521"
                }
            }
        },
        "INDMZNetworkAclEntry230": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "230",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "false",
                "CidrBlock": "0.0.0.0/0",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "49152",
                    "To": "65535"
                }
            }
        },
        "INDMZNetworkAclEntry240": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "240",
                "Protocol": "17",
                "RuleAction": "allow",
                "Egress": "false",
                "CidrBlock": "0.0.0.0/0",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "49152",
                    "To": "65535"
                }
            }
        },
        "INDMZNetworkAclEntry270": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "270",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "false",
                "CidrBlock": "172.19.20.34/32",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "4505",
                    "To": "4506"
                }
            }
        },
        "OUTDMZNetworkAclEntry150": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "150",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "true",
                "CidrBlock": "0.0.0.0/0",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "443",
                    "To": "443"
                }
            }
        },
        "OUTDMZNetworkAclEntry160": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "160",
                "Protocol": "1",
                "RuleAction": "allow",
                "Egress": "true",
                "CidrBlock": "172.19.0.0/16",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "-1",
                    "To": "-1"
                }
            }
        },
        "OUTDMZNetworkAclEntry230": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "230",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "true",
                "CidrBlock": "0.0.0.0/0",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "80",
                    "To": "80"
                }
            }
        },
        "OUTDMZNetworkAclEntry209": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "209",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "true",
                "CidrBlock": "172.19.10.11/32",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "1521",
                    "To": "1521"
                }
            }
        },
        "OUTDMZNetworkAclEntry260": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "260",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "true",
                "CidrBlock": "0.0.0.0/0",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "4505",
                    "To": "4506"
                }
            }
        },
        "OUTDMZNetworkAclEntry270": {
            "Type": "AWS::EC2::NetworkAclEntry",
            "Properties": {
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                },
                "RuleNumber": "270",
                "Protocol": "6",
                "RuleAction": "allow",
                "Egress": "true",
                "CidrBlock": "172.19.0.0/16",
                "Icmp": {
                    "Code": "-1",
                    "Type": "-1"
                },
                "PortRange": {
                    "From": "49152",
                    "To": "65535"
                }
            }
        },
        "SubnetNetworkAclAssociation": {
            "Type": "AWS::EC2::SubnetNetworkAclAssociation",
            "Properties": {
                "SubnetId": {
                    "Ref": "Private4Subnet"
                },
                "NetworkAclId": {
                    "Ref": "DMZNetworkAcl"
                }
            }
        },
        "LogsBucketPolicy": {
            "Type": "AWS::S3::BucketPolicy",
            "Properties": {
                "Bucket": {
                    "Ref": "regionalCloudsuiteBucket"
                },
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Sid": "ELBAccessLogs20140725",
                            "Effect": "Allow",
                            "Resource": {
                                "Fn::Join": [
                                    "",
                                    [
                                        "arn:aws:s3:::",
                                        {
                                            "Ref": "regionalCloudsuiteBucket"
                                        },
                                        "/*"
                                    ]
                                ]
                            },
                            "Principal": "*",
                            "Action": [
                                "s3:PutObject"
                            ]
                        }
                    ]
                }
            }
        },
        "RootRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Principal": {
                                "Service": [
                                    "ec2.amazonaws.com"
                                ]
                            },
                            "Action": [
                                "sts:AssumeRole"
                            ]
                        }
                    ]
                },
                "Path": "/"
            }
        },
        "RolePolicies": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": "root",
                "PolicyDocument": {
                    "Statement": [
                        {
                            "Effect": "Allow",
                            "Action": [
                                "ec2:CreateTags",
                                "ec2:DeleteTags",
                                "ec2:DescribeAddresses",
                                "ec2:DescribeAvailabilityZones",
                                "ec2:DescribeImages",
                                "ec2:DescribeInstanceAttribute",
                                "ec2:DescribeInstanceStatus",
                                "ec2:DescribeInstances",
                                "ec2:DescribeRegions",
                                "ec2:DescribeTags",
                                "ec2:DescribeVolumeAttribute",
                                "ec2:DescribeVolumeStatus",
                                "ec2:DescribeVolumes",
                                "ec2:CreateImage",
                                "ec2:DescribeImageAttribute",
                                "ec2:CreateSnapshot",
                                "ec2:DescribeSnapshotAttribute",
                                "ec2:DescribeSnapshots",
                                "ec2:DeleteSnapshot",
                                "s3:CreateBucket",
                                "s3:GetBucketAcl",
                                "s3:GetBucketLocation",
                                "s3:GetBucketTagging",
                                "s3:GetObject",
                                "s3:GetObjectAcl",
                                "s3:ListAllMyBuckets",
                                "s3:ListBucket",
                                "s3:ListBucketMultipartUploads",
                                "s3:PutBucketAcl",
                                "s3:PutBucketLogging",
                                "s3:PutObject",
                                "s3:PutObjectAcl",
                                "s3:PutObjectVersionAcl",
                                "s3:DeleteObject",
                                "s3:DeleteObjectVersion"
                            ],
                            "Resource": "*"
                        }
                    ]
                },
                "Roles": [
                    {
                        "Ref": "RootRole"
                    }
                ]
            }
        },
        "RootInstanceProfile": {
            "Type": "AWS::IAM::InstanceProfile",
            "Properties": {
                "Path": "/",
                "Roles": [
                    {
                        "Ref": "RootRole"
                    }
                ]
            }
        },
        "NATIPAddress": {
            "Type": "AWS::EC2::EIP",
            "DependsOn": "GatewayToInternet",
            "Properties": {
                "Domain": "vpc",
                "InstanceId": {
                    "Ref": "NATDevice"
                }
            }
        },
        "NATDevice": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": "NATSecurityGroup",
            "Properties": {
                "InstanceType": {
                    "Ref": "NATInstanceType"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "PublicSubnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "NAT",
                        "Address"
                    ]
                },
                "SourceDestCheck": "false",
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCNT01",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "NATSecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-NATServer"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCNT01"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "3ebf68ff-83c1-4646-8f6d-0f6abfb9f72d"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeSize": "10",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTABLESSYSCONFIG=/etc/sysconfig/iptables-config",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE1=/var/ec2/greeneggs.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/NATroute.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'IPTSCEOF'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTABLES_MODULES=\"\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTABLES_MODULES_UNLOAD=\"yes\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTABLES_SAVE_ON_STOP=\"yes\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTABLES_SAVE_ON_RESTART=\"yes\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTABLES_SAVE_COUNTER=\"no\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTABLES_STATUS_NUMERIC=\"yes\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTABLES_STATUS_VERBOSE=\"no\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTABLES_STATUS_LINENUMBERS=\"yes\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "IPTSCEOF",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $IPTABLESSYSCONFIG",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig iptables on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/net\\.ipv4\\.ip_forward = 0/net\\.ipv4\\.ip_forward = 1/' /etc/sysctl.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/net\\.ipv4\\.conf\\.default\\.rp_filter = 0/net\\.ipv4\\.conf\\.default\\.rp_filter = 1/' /etc/sysctl.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/net\\.ipv4\\.conf\\.default\\.accept_source_route = 1/net\\.ipv4\\.conf\\.default\\.accept_source_route = 0/' /etc/sysctl.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 1 > /proc/sys/net/ipv4/ip_forward",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sysctl -p",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "iptables -t nat -A POSTROUTING -j MASQUERADE",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service iptables stop",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service iptables save",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service iptables start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/inforbc\\.com/ec2.internal/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.11\\.10/172\\.18\\.0\\.2/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCNT01]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "cbUrl",
                                            {
                                                "Ref": "NATWaitHandle"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=3ebf68ff-83c1-4646-8f6d-0f6abfb9f72d",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 150",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 150",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"NAT setup complete\" '",
                                            {
                                                "Ref": "NATWaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCNT01-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval MasterServer https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval agentGuid 3ebf68ff-83c1-4646-8f6d-0f6abfb9f72d",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval CustPrefix cs-wfm-00-prd",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval ScenarioId 13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval version "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "version"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval StackId "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "AWS::StackId"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval suitename wfm",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval csname CLOUDSUITE-WFM",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval sumo-collector-prefix saas.aws.st.app.cloudsuite-WFM.cs-wfm-00-prd.network",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval installedproduct testapp",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval installedproductver 1.0",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "yum install python-pip -y",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pip install -U boto",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "curl -X PUT -H 'Content-Type:' --data-binary '{\"Status\" : \"SUCCESS\",\"Reason\" : \"Configuration Complete in NAT\",\"UniqueId\" : \"ID1234\",\"Data\" : \" NAT Application has completed configuration.\"}' \"",
                                            {
                                                "Ref": "NATWaitHandle"
                                            },
                                            "\"\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ntpdate -s pool.ntp.org",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig ntpd on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service ntpd restart",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "NATSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the NAT device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-NATSecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "80",
                        "ToPort": "80",
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "443",
                        "ToPort": "443",
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "21",
                        "ToPort": "21",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "587",
                        "ToPort": "587",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "25",
                        "ToPort": "25",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "587",
                        "ToPort": "587",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ],
                "SecurityGroupEgress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "25",
                        "ToPort": "25",
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "80",
                        "ToPort": "80",
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "21",
                        "ToPort": "21",
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "443",
                        "ToPort": "443",
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "587",
                        "ToPort": "587",
                        "CidrIp": "0.0.0.0/0"
                    }
                ]
            }
        },
        "NATWaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "NATDevice",
            "Properties": {
                "Handle": {
                    "Ref": "NATWaitHandle"
                },
                "Timeout": "7200"
            }
        },
        "NATWaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCWS01Instance": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "NATWaitCondition",
                "INFORBCWS01SecurityGroup",
                "IRWaitCondition"
            ],
            "Properties": {
                "InstanceType": {
                    "Ref": "INFORBCWS01Type"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "Private1Subnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "WS1",
                        "Address"
                    ]
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCWS01",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCWS01SecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCWS01Server"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCWS01"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "eb10994b-e5d0-43c0-992d-b6b05c080661"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "xvdd",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /var/ec2/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE9=/var/ec2/createfilesystem.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCWS01]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=eb10994b-e5d0-43c0-992d-b6b05c080661",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCWS01-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'MasterServer: https://cops.cloudsuite.infor.com' > /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'agentGuid: eb10994b-e5d0-43c0-992d-b6b05c080661' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'ScenarioId: 13847' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'version: ",
                                            {
                                                "Ref": "version"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'StackId: ",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'suitename: wfm' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'vpcId: ",
                                            {
                                                "Ref": "VPC"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'VPCCIDR: ",
                                            {
                                                "Ref": "VPCCIDR"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'awsregion: ",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'csname: CLOUDSUITE-WFM' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'hostname: INFORBCWS01' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'monitoringType: ",
                                            {
                                                "Ref": "monitoringType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'CustPrefix: ",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'shortName: ",
                                            {
                                                "Ref": "shortName"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'dbsid: ",
                                            {
                                                "Ref": "dbsid"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'envType: ",
                                            {
                                                "Ref": "envType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'sumo-collector-prefix: saas.aws.st.app.CLOUDSUITE-WFM.cs-wfm-00-prd.network' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion stop",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service csagent stop;rm -rf /etc/init.d/csagent;rm -rf /opt/csagent/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"WS1 setup complete\" '",
                                            {
                                                "Ref": "WS1WaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS9'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "filesystem=\"xvdd-data02\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "for fs in $filesystem",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "do",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str1=`echo $fs | cut -d '-' -f1`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str2=`echo $fs | cut -d '-' -f2`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pattern=`grep $str1 /etc/fstab | wc -l`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ $pattern -eq 0 ];",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"creating file system $str1\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkfs -t ext4 /dev/$str1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mount /dev/$str1 /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"/dev/$str1 /$str2 ext4 defaults,nofail 0 2\" >> /etc/fstab",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "done",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE9\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/createfilesystem.sh' >> /var/ec2/createfilesystem.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "WS1WaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "INFORBCWS01Instance",
            "Properties": {
                "Handle": {
                    "Ref": "WS1WaitHandle"
                },
                "Timeout": "10800"
            }
        },
        "WS1WaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCWS01SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the INFORBCWS01 device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCWS01SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14043",
                        "ToPort": "14043",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14088",
                        "ToPort": "14088",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        },
        "INFORBCWSSecurityGroupELB": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCWSSecurityGroupELB"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "GroupDescription": "INFORBCWS01 Server Security Group",
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "443",
                        "ToPort": "443",
                        "CidrIp": "0.0.0.0/0"
                    }
                ]
            }
        },
        "INFORBCWSElasticLoadBalancer": {
            "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
            "DependsOn": [
                "INFORBCWSSecurityGroupELB",
                "PublicSubnet"
            ],
            "Properties": {
                "SecurityGroups": [
                    {
                        "Ref": "INFORBCWSSecurityGroupELB"
                    }
                ],
                "Subnets": [
                    {
                        "Ref": "PublicSubnet"
                    },
                    {
                        "Ref": "Private2Subnet"
                    }
                ],
                "Instances": [
                    {
                        "Ref": "INFORBCWS01Instance"
                    },
                    {
                        "Ref": "INFORBCWS02Instance"
                    }
                ],
                "CrossZone": true,
                "Scheme": "internet-facing",
                "Listeners": [
                    {
                        "LoadBalancerPort": "443",
                        "InstancePort": "14043",
                        "Protocol": "SSL",
                        "InstanceProtocol": "SSL",
                        "SSLCertificateId": {
                            "Fn::Join": [
                                "",
                                [
                                    "arn:aws:iam::",
                                    {
                                        "Ref": "AWS::AccountId"
                                    },
                                    ":server-certificate/cloud.infor.com"
                                ]
                            ]
                        }
                    }
                ],
                "HealthCheck": {
                    "Target": "HTTP:14088/healthcheck.html",
                    "HealthyThreshold": "3",
                    "UnhealthyThreshold": "2",
                    "Interval": "30",
                    "Timeout": "10"
                },
                "ConnectionDrainingPolicy": {
                    "Enabled": "true",
                    "Timeout": "300"
                },
                "AccessLoggingPolicy": {
                    "S3BucketName": {
                        "Ref": "regionalCloudsuiteBucket"
                    },
                    "S3BucketPrefix": {
                        "Fn::Join": [
                            "",
                            [
                                "elblogs",
                                "/",
                                {
                                    "Ref": "prefix"
                                }
                            ]
                        ]
                    },
                    "Enabled": "true",
                    "EmitInterval": "60"
                }
            }
        },
        "INFORBCWS02Instance": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "NATWaitCondition",
                "INFORBCWS02SecurityGroup",
                "IRWaitCondition"
            ],
            "Properties": {
                "InstanceType": {
                    "Ref": "INFORBCWS02Type"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "Private2Subnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "WS2",
                        "Address"
                    ]
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCWS02",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCWS02SecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCWS02Server"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCWS02"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "ab1857e2-70e7-4e1b-9989-f8cc83d65301"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "xvdd",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /var/ec2/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE9=/var/ec2/createfilesystem.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCWS02]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=ab1857e2-70e7-4e1b-9989-f8cc83d65301",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCWS02-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'MasterServer: https://cops.cloudsuite.infor.com' > /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'agentGuid: ab1857e2-70e7-4e1b-9989-f8cc83d65301' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'ScenarioId: 13847' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'version: ",
                                            {
                                                "Ref": "version"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'StackId: ",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'suitename: wfm' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'vpcId: ",
                                            {
                                                "Ref": "VPC"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'VPCCIDR: ",
                                            {
                                                "Ref": "VPCCIDR"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'awsregion: ",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'csname: CLOUDSUITE-WFM' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'hostname: INFORBCWS02' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'monitoringType: ",
                                            {
                                                "Ref": "monitoringType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'CustPrefix: ",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'shortName: ",
                                            {
                                                "Ref": "shortName"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'dbsid: ",
                                            {
                                                "Ref": "dbsid"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'envType: ",
                                            {
                                                "Ref": "envType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'sumo-collector-prefix: saas.aws.st.app.CLOUDSUITE-WFM.cs-wfm-00-prd.network' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion stop",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service csagent stop;rm -rf /etc/init.d/csagent;rm -rf /opt/csagent/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"WS2 setup complete\" '",
                                            {
                                                "Ref": "WS2WaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS9'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "filesystem=\"xvdd-data02\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "for fs in $filesystem",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "do",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str1=`echo $fs | cut -d '-' -f1`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str2=`echo $fs | cut -d '-' -f2`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pattern=`grep $str1 /etc/fstab | wc -l`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ $pattern -eq 0 ];",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"creating file system $str1\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkfs -t ext4 /dev/$str1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mount /dev/$str1 /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"/dev/$str1 /$str2 ext4 defaults,nofail 0 2\" >> /etc/fstab",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "done",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE9\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/createfilesystem.sh' >> /var/ec2/createfilesystem.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "WS2WaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "INFORBCWS02Instance",
            "Properties": {
                "Handle": {
                    "Ref": "WS2WaitHandle"
                },
                "Timeout": "10800"
            }
        },
        "WS2WaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCWS02SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the INFORBCWS02 device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCWS02SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14043",
                        "ToPort": "14043",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14088",
                        "ToPort": "14088",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        },
        "INFORBCWL01Instance": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "NATWaitCondition",
                "INFORBCWL01SecurityGroup",
                "DBWaitCondition"
            ],
            "Properties": {
                "InstanceType": {
                    "Ref": "INFORBCWL01Type"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "Private1Subnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "WL1",
                        "Address"
                    ]
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCWL01",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCWL01SecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCWL01Server"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCWL01"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "922c1b54-99a9-49cc-a11f-13031bf639ec"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "xvdd",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /var/ec2/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE9=/var/ec2/createfilesystem.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCWL01]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=922c1b54-99a9-49cc-a11f-13031bf639ec",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCWL01-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'MasterServer: https://cops.cloudsuite.infor.com' > /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'agentGuid: 922c1b54-99a9-49cc-a11f-13031bf639ec' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'ScenarioId: 13847' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'version: ",
                                            {
                                                "Ref": "version"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'StackId: ",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'suitename: wfm' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'vpcId: ",
                                            {
                                                "Ref": "VPC"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'VPCCIDR: ",
                                            {
                                                "Ref": "VPCCIDR"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'awsregion: ",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'csname: CLOUDSUITE-WFM' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'hostname: INFORBCWL01' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'monitoringType: ",
                                            {
                                                "Ref": "monitoringType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'CustPrefix: ",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'shortName: ",
                                            {
                                                "Ref": "shortName"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'dbsid: ",
                                            {
                                                "Ref": "dbsid"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'envType: ",
                                            {
                                                "Ref": "envType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'sumo-collector-prefix: saas.aws.st.app.CLOUDSUITE-WFM.cs-wfm-00-prd.network' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion stop",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service csagent stop;rm -rf /etc/init.d/csagent;rm -rf /opt/csagent/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"WL1 setup complete\" '",
                                            {
                                                "Ref": "WL1WaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS9'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "filesystem=\"xvdd-data02\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "for fs in $filesystem",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "do",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str1=`echo $fs | cut -d '-' -f1`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str2=`echo $fs | cut -d '-' -f2`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pattern=`grep $str1 /etc/fstab | wc -l`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ $pattern -eq 0 ];",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"creating file system $str1\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkfs -t ext4 /dev/$str1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mount /dev/$str1 /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"/dev/$str1 /$str2 ext4 defaults,nofail 0 2\" >> /etc/fstab",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "done",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE9\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/createfilesystem.sh' >> /var/ec2/createfilesystem.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "WL1WaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "INFORBCWL01Instance",
            "Properties": {
                "Handle": {
                    "Ref": "WL1WaitHandle"
                },
                "Timeout": "10800"
            }
        },
        "WL1WaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCWL01SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the INFORBCWL01 device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCWL01SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14043",
                        "ToPort": "14043",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14001",
                        "ToPort": "14001",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14003",
                        "ToPort": "14003",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        },
        "INFORBCWL02Instance": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "NATWaitCondition",
                "INFORBCWL02SecurityGroup",
                "WL1WaitCondition"
            ],
            "Properties": {
                "InstanceType": {
                    "Ref": "INFORBCWL02Type"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "Private2Subnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "WL2",
                        "Address"
                    ]
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCWL02",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCWL02SecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCWL02Server"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCWL02"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "2424d24f-4fc7-4ff3-82e0-9efb6ee41d72"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "xvdd",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /var/ec2/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE9=/var/ec2/createfilesystem.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCWL02]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=2424d24f-4fc7-4ff3-82e0-9efb6ee41d72",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCWL02-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'MasterServer: https://cops.cloudsuite.infor.com' > /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'agentGuid: 2424d24f-4fc7-4ff3-82e0-9efb6ee41d72' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'ScenarioId: 13847' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'version: ",
                                            {
                                                "Ref": "version"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'StackId: ",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'suitename: wfm' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'vpcId: ",
                                            {
                                                "Ref": "VPC"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'VPCCIDR: ",
                                            {
                                                "Ref": "VPCCIDR"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'awsregion: ",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'csname: CLOUDSUITE-WFM' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'hostname: INFORBCWL02' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'monitoringType: ",
                                            {
                                                "Ref": "monitoringType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'CustPrefix: ",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'shortName: ",
                                            {
                                                "Ref": "shortName"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'dbsid: ",
                                            {
                                                "Ref": "dbsid"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'envType: ",
                                            {
                                                "Ref": "envType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'sumo-collector-prefix: saas.aws.st.app.CLOUDSUITE-WFM.cs-wfm-00-prd.network' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion stop",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service csagent stop;rm -rf /etc/init.d/csagent;rm -rf /opt/csagent/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"WL2 setup complete\" '",
                                            {
                                                "Ref": "WL2WaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS9'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "filesystem=\"xvdd-data02\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "for fs in $filesystem",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "do",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str1=`echo $fs | cut -d '-' -f1`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str2=`echo $fs | cut -d '-' -f2`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pattern=`grep $str1 /etc/fstab | wc -l`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ $pattern -eq 0 ];",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"creating file system $str1\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkfs -t ext4 /dev/$str1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mount /dev/$str1 /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"/dev/$str1 /$str2 ext4 defaults,nofail 0 2\" >> /etc/fstab",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "done",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE9\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/createfilesystem.sh' >> /var/ec2/createfilesystem.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "INFORBCWL02SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the INFORBCWL02 device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCWL02SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14043",
                        "ToPort": "14043",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14001",
                        "ToPort": "14001",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14003",
                        "ToPort": "14003",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        },
        "WL2WaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "INFORBCWL02Instance",
            "Properties": {
                "Handle": {
                    "Ref": "WL2WaitHandle"
                },
                "Timeout": "10800"
            }
        },
        "WL2WaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCIR01Instance": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "NATWaitCondition",
                "INFORBCIR01SecurityGroup",
                "DBWaitCondition"
            ],
            "Properties": {
                "InstanceType": {
                    "Ref": "INFORBCIR01Type"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "Private1Subnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "IR",
                        "Address"
                    ]
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCIR01",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCIR01SecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCIR01Server"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCIR01"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "f1b61dcd-0f6f-4a19-a229-e218140183d6"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "xvdd",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /var/ec2/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE9=/var/ec2/createfilesystem.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCIR01]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=f1b61dcd-0f6f-4a19-a229-e218140183d6",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCIR01-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'MasterServer: https://cops.cloudsuite.infor.com' > /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'agentGuid: f1b61dcd-0f6f-4a19-a229-e218140183d6' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'ScenarioId: 13847' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'version: ",
                                            {
                                                "Ref": "version"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'StackId: ",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'suitename: wfm' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'vpcId: ",
                                            {
                                                "Ref": "VPC"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'VPCCIDR: ",
                                            {
                                                "Ref": "VPCCIDR"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'awsregion: ",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'csname: CLOUDSUITE-WFM' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'hostname: INFORBCIR01' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'monitoringType: ",
                                            {
                                                "Ref": "monitoringType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'CustPrefix: ",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'shortName: ",
                                            {
                                                "Ref": "shortName"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'dbsid: ",
                                            {
                                                "Ref": "dbsid"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'envType: ",
                                            {
                                                "Ref": "envType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'sumo-collector-prefix: saas.aws.st.app.CLOUDSUITE-WFM.cs-wfm-00-prd.network' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion stop",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service csagent stop;rm -rf /etc/init.d/csagent;rm -rf /opt/csagent/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"Reporting setup complete\" '",
                                            {
                                                "Ref": "IRWaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS9'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "filesystem=\"xvdd-data02\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "for fs in $filesystem",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "do",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str1=`echo $fs | cut -d '-' -f1`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str2=`echo $fs | cut -d '-' -f2`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pattern=`grep $str1 /etc/fstab | wc -l`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ $pattern -eq 0 ];",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"creating file system $str1\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkfs -t ext4 /dev/$str1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mount /dev/$str1 /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"/dev/$str1 /$str2 ext4 defaults,nofail 0 2\" >> /etc/fstab",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "done",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE9\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/createfilesystem.sh' >> /var/ec2/createfilesystem.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "INFORBCIR01SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the INFORBCIR01 device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCIR01SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "443",
                        "ToPort": "443",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        },
        "IRWaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "INFORBCIR01Instance",
            "Properties": {
                "Handle": {
                    "Ref": "IRWaitHandle"
                },
                "Timeout": "10800"
            }
        },
        "IRWaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCJB01IPAddress": {
            "Type": "AWS::EC2::EIP",
            "DependsOn": "GatewayToInternet",
            "Properties": {
                "Domain": "vpc",
                "InstanceId": {
                    "Ref": "INFORBCJB01Instance"
                }
            }
        },
        "INFORBCJB01Instance": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "NATWaitCondition",
                "INFORBCJB01SecurityGroup",
                "DBWaitCondition"
            ],
            "Properties": {
                "InstanceType": {
                    "Ref": "INFORBCJB01Type"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "PublicSubnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "JB",
                        "Address"
                    ]
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCJB01",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCJB01SecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCJB01Server"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCJB01"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "b4db0d58-4073-4ef0-be7e-5b9f7f0587ea"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "xvdd",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /var/ec2/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE9=/var/ec2/createfilesystem.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCJB01]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=b4db0d58-4073-4ef0-be7e-5b9f7f0587ea",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCJB01-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'MasterServer: https://cops.cloudsuite.infor.com' > /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'agentGuid: b4db0d58-4073-4ef0-be7e-5b9f7f0587ea' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'ScenarioId: 13847' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'version: ",
                                            {
                                                "Ref": "version"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'StackId: ",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'suitename: wfm' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'vpcId: ",
                                            {
                                                "Ref": "VPC"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'VPCCIDR: ",
                                            {
                                                "Ref": "VPCCIDR"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'awsregion: ",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'csname: CLOUDSUITE-WFM' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'hostname: INFORBCJB01' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'monitoringType: ",
                                            {
                                                "Ref": "monitoringType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'CustPrefix: ",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'shortName: ",
                                            {
                                                "Ref": "shortName"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'dbsid: ",
                                            {
                                                "Ref": "dbsid"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'envType: ",
                                            {
                                                "Ref": "envType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'sumo-collector-prefix: saas.aws.st.app.CLOUDSUITE-WFM.cs-wfm-00-prd.network' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion stop",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service csagent stop;rm -rf /etc/init.d/csagent;rm -rf /opt/csagent/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"JB setup complete\" '",
                                            {
                                                "Ref": "JBWaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS9'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "filesystem=\"xvdd-data02\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "for fs in $filesystem",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "do",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str1=`echo $fs | cut -d '-' -f1`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str2=`echo $fs | cut -d '-' -f2`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pattern=`grep $str1 /etc/fstab | wc -l`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ $pattern -eq 0 ];",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"creating file system $str1\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkfs -t ext4 /dev/$str1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mount /dev/$str1 /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"/dev/$str1 /$str2 ext4 defaults,nofail 0 2\" >> /etc/fstab",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "done",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE9\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/createfilesystem.sh' >> /var/ec2/createfilesystem.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "JBWaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "INFORBCJB01Instance",
            "Properties": {
                "Handle": {
                    "Ref": "JBWaitHandle"
                },
                "Timeout": "10800"
            }
        },
        "JBWaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCJB01SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the INFORBCJB01 device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCJB01SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "443",
                        "ToPort": "443",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        },
        "INFORBCADM01IPAddress": {
            "Type": "AWS::EC2::EIP",
            "DependsOn": "GatewayToInternet",
            "Properties": {
                "Domain": "vpc",
                "InstanceId": {
                    "Ref": "INFORBCADM01Instance"
                }
            }
        },
        "INFORBCADM01Instance": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "NATWaitCondition",
                "INFORBCADM01SecurityGroup"
            ],
            "Properties": {
                "InstanceType": {
                    "Ref": "INFORBCADM01Type"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "PublicSubnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "ADM",
                        "Address"
                    ]
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCADM01",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCADM01SecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCADM01Server"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCADM01"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "20525b85-f653-485a-99a0-a9467cdbde91"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "xvdd",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /var/ec2/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE9=/var/ec2/createfilesystem.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCADM01]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=20525b85-f653-485a-99a0-a9467cdbde91",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCADM01-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'MasterServer: https://cops.cloudsuite.infor.com' > /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'agentGuid: 20525b85-f653-485a-99a0-a9467cdbde91' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'ScenarioId: 13847' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'version: ",
                                            {
                                                "Ref": "version"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'StackId: ",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'suitename: wfm' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'vpcId: ",
                                            {
                                                "Ref": "VPC"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'VPCCIDR: ",
                                            {
                                                "Ref": "VPCCIDR"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'awsregion: ",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'csname: CLOUDSUITE-WFM' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'hostname: INFORBCADM01' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'monitoringType: ",
                                            {
                                                "Ref": "monitoringType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'CustPrefix: ",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'shortName: ",
                                            {
                                                "Ref": "shortName"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'dbsid: ",
                                            {
                                                "Ref": "dbsid"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'envType: ",
                                            {
                                                "Ref": "envType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'sumo-collector-prefix: saas.aws.st.app.CLOUDSUITE-WFM.cs-wfm-00-prd.network' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion stop",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service csagent stop;rm -rf /etc/init.d/csagent;rm -rf /opt/csagent/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"ADMIN setup complete\" '",
                                            {
                                                "Ref": "ADMWaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS9'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "filesystem=\"xvdd-data02\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "for fs in $filesystem",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "do",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str1=`echo $fs | cut -d '-' -f1`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str2=`echo $fs | cut -d '-' -f2`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pattern=`grep $str1 /etc/fstab | wc -l`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ $pattern -eq 0 ];",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"creating file system $str1\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkfs -t ext4 /dev/$str1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mount /dev/$str1 /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"/dev/$str1 /$str2 ext4 defaults,nofail 0 2\" >> /etc/fstab",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "done",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE9\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/createfilesystem.sh' >> /var/ec2/createfilesystem.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "ADMWaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "INFORBCADM01Instance",
            "Properties": {
                "Handle": {
                    "Ref": "ADMWaitHandle"
                },
                "Timeout": "10800"
            }
        },
        "ADMWaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCADM01SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the INFORBCADM01 device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCADM01SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "443",
                        "ToPort": "443",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        },
        "INFORBCDA01Instance": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "NATWaitCondition",
                "INFORBCDA01SecurityGroup"
            ],
            "Properties": {
                "InstanceType": {
                    "Ref": "INFORBCDA01Type"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "Private1Subnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "DASH",
                        "Address"
                    ]
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCDA01",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCDA01SecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCDA01Server"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCDA01"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "8de62e1e-a97a-46ef-bd6c-f8399170adde"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "xvdd",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /var/ec2/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE9=/var/ec2/createfilesystem.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCDA01]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=8de62e1e-a97a-46ef-bd6c-f8399170adde",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCDA01-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'MasterServer: https://cops.cloudsuite.infor.com' > /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'agentGuid: 8de62e1e-a97a-46ef-bd6c-f8399170adde' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'ScenarioId: 13847' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'version: ",
                                            {
                                                "Ref": "version"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'StackId: ",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'suitename: wfm' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'vpcId: ",
                                            {
                                                "Ref": "VPC"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'VPCCIDR: ",
                                            {
                                                "Ref": "VPCCIDR"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'awsregion: ",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'csname: CLOUDSUITE-WFM' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'hostname: INFORBCDA01' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'monitoringType: ",
                                            {
                                                "Ref": "monitoringType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'CustPrefix: ",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'shortName: ",
                                            {
                                                "Ref": "shortName"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'dbsid: ",
                                            {
                                                "Ref": "dbsid"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'envType: ",
                                            {
                                                "Ref": "envType"
                                            },
                                            "' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'sumo-collector-prefix: saas.aws.st.app.CLOUDSUITE-WFM.cs-wfm-00-prd.network' >> /etc/salt/grains",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion stop",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service csagent stop;rm -rf /etc/init.d/csagent;rm -rf /opt/csagent/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"DASH setup complete\" '",
                                            {
                                                "Ref": "DAWaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS9'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "filesystem=\"xvdd-data02\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "for fs in $filesystem",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "do",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str1=`echo $fs | cut -d '-' -f1`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str2=`echo $fs | cut -d '-' -f2`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pattern=`grep $str1 /etc/fstab | wc -l`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ $pattern -eq 0 ];",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"creating file system $str1\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkfs -t ext4 /dev/$str1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mount /dev/$str1 /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"/dev/$str1 /$str2 ext4 defaults,nofail 0 2\" >> /etc/fstab",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "done",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE9\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/createfilesystem.sh' >> /var/ec2/createfilesystem.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "DAWaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "INFORBCDA01Instance",
            "Properties": {
                "Handle": {
                    "Ref": "DAWaitHandle"
                },
                "Timeout": "10800"
            }
        },
        "DAWaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCDA01SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the INFORBCDA01 device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCDA01SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "443",
                        "ToPort": "443",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        },
        "INFORBCDB01Device": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "INFORBCDB01SecurityGroup",
                "NATWaitCondition"
            ],
            "Properties": {
                "InstanceType": {
                    "Ref": "INFORBCDB01Type"
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "SubnetId": {
                    "Ref": "Private3Subnet"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "DB",
                        "Address"
                    ]
                },
                "EbsOptimized": "true",
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCDB01",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCDB01SecurityGroup"
                    }
                ],
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCDB01Server"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCDB01"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "fda033db-1559-48be-8b86-01b73f6a6291"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "xvdd",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "xvde",
                        "Ebs": {
                            "VolumeSize": "100",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "xvdf",
                        "Ebs": {
                            "VolumeSize": "100",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "xvdg",
                        "Ebs": {
                            "VolumeSize": "200",
                            "VolumeType": "gp2"
                        }
                    },
                    {
                        "DeviceName": "xvdh",
                        "Ebs": {
                            "VolumeSize": "100",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "\n",
                            [
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "#!/bin/bash",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /var/ec2/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE3=/var/ec2/wininit.params",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE4=/var/ec2/salt.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE9=/var/ec2/createfilesystem.sh",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "SCRIPTFILE2=/var/ec2/s3.py",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS3'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCDB01]",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "CustPrefix",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "=",
                                        [
                                            "VERSION",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "MasterServer=https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "ScenarioId=13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "agentGuid=fda033db-1559-48be-8b86-01b73f6a6291",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS9'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "filesystem=\"xvdd-ora_install xvde-data01 xvdf-index01 xvdg-backup01 xvdh-logs01\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "for fs in $filesystem",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "do",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str1=`echo $fs | cut -d '-' -f1`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "str2=`echo $fs | cut -d '-' -f2`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "pattern=`grep $str1 /etc/fstab | wc -l`",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ $pattern -eq 0 ];",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"creating file system $str1\"",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkfs -t ext4 /dev/$str1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mkdir -p /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "mount /dev/$str1 /$str2",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"/dev/$str1 /$str2 ext4 defaults,nofail 0 2\" >> /etc/fstab",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "done",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "# -----------------------------------------------------------",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "(",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "easy_install https://s3.amazonaws.com/cloudformation-examples/aws-cfn-bootstrap-latest.tar.gz",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 45",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cat <<'EOPS4'",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo 'Defaults:ec2-user !requiretty' >> /etc/sudoers",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 5",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "echo \"master: salt-mark.epiengcloud.com\" >> /etc/salt/minion",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "echo \"id: WFM-INFORBCDB01-"
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "prefix"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "-",
                                                        ""
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "\" >> /etc/salt/minion"
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "chkconfig salt-minion on",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service salt-minion start",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "service csagent stop;rm -rf /etc/init.d/csagent;rm -rf /opt/csagent/",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval MasterServer https://cops.cloudsuite.infor.com",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval agentGuid fda033db-1559-48be-8b86-01b73f6a6291",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval CustPrefix cs-wfm-00-prd",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval shortName "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "shortName"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval dbsid "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "dbsid"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval envType "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "envType"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval ScenarioId 13847",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval version "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "version"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval vpcId "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPC"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval VPCCIDR "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "VPCCIDR"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval awsregion "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "AWS::Region"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        "/usr/bin/salt-call grains.setval StackId "
                                                    ]
                                                ]
                                            },
                                            {
                                                "Fn::Join": [
                                                    "",
                                                    [
                                                        {
                                                            "Ref": "AWS::StackId"
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval suitename wfm",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval csname CLOUDSUITE-WFM",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval sumo-collector-prefix saas.aws.st.app.cloudsuite-WFM.cs-wfm-00-prd.network",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval installedproduct testapp",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call grains.setval installedproductver 1.0",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/usr/bin/salt-call state.highstate",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sleep 10",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "cfn-signal -e 0 -r \"DB setup complete\" '",
                                            {
                                                "Ref": "DBWaitHandle"
                                            },
                                            "'\n",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "EOPS4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            ") > $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE4\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE4",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE3\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE3",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "if [ -f \"$SCRIPTFILE9\" ]; then",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "  chmod 755 $SCRIPTFILE9",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "fi",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/createfilesystem.sh' >> /var/ec2/createfilesystem.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "/bin/bash -c '/var/ec2/salt.sh' >> /var/ec2/salt.out 2>&1",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/ec2.internal/inforbc\\.com/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                },
                                {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sed -i -e 's/172\\.18\\.0\\.2/172\\.18\\.11\\.10/' /etc/resolv.conf",
                                            ""
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                }
            }
        },
        "DBWaitCondition": {
            "Type": "AWS::CloudFormation::WaitCondition",
            "DependsOn": "INFORBCDB01Device",
            "Properties": {
                "Handle": {
                    "Ref": "DBWaitHandle"
                },
                "Timeout": "10800"
            }
        },
        "DBWaitHandle": {
            "Type": "AWS::CloudFormation::WaitConditionHandle"
        },
        "INFORBCDB01SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "DependsOn": "VPC",
            "Properties": {
                "GroupDescription": "Enable internal access to the INFORBCDB01 device",
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCDB01SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "14051",
                        "ToPort": "14051",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4505",
                        "ToPort": "4505",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "4506",
                        "ToPort": "4506",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        },
        "INFORBCJMP01Instance": {
            "Type": "AWS::EC2::Instance",
            "DependsOn": [
                "NATWaitCondition",
                "INFORBCJMP01SecurityGroup",
                "DBWaitCondition"
            ],
            "Metadata": {
                "AWS::CloudFormation::Init": {
                    "config": {
                        "packages": {
                            "msi": {
                                "7zip": "http://infor-software-dumps.s3.amazonaws.com/SingleTenant/7z920-x64.msi"
                            }
                        },
                        "files": {
                            "c:\\Windows\\cwi\\wininit.params": {
                                "content": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[INFORBCJMP01]\n",
                                            "stack=",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            "\n",
                                            "region=",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\n",
                                            "CustPrefix=",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "\n",
                                            "VERSION=",
                                            {
                                                "Ref": "version"
                                            },
                                            "\n",
                                            "MasterServer=https://cops.cloudsuite.infor.com\n",
                                            "domainName=",
                                            {
                                                "Ref": "DomainName"
                                            },
                                            "\n",
                                            "ScenarioId=13847\n",
                                            "HostName=INFORBCJMP01\n",
                                            "agentGuid=9bd91216-a600-46ef-b492-5ed4959b2d8a\n"
                                        ]
                                    ]
                                }
                            },
                            "c:\\Windows\\cwi\\hooks.d\\cfn-auto-reloader.conf": {
                                "content": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "[cfn-auto-reloader-hook]\n",
                                            "triggers=post.update\n",
                                            "path=Resources.INFORBCJMP01Instance.Metadata.AWS::CloudFormation::Init\n",
                                            "action=cfn-init.exe -v -s ",
                                            {
                                                "Ref": "AWS::StackId"
                                            },
                                            " -r INFORBCJMP01Instance",
                                            " --region ",
                                            {
                                                "Ref": "AWS::Region"
                                            },
                                            "\n"
                                        ]
                                    ]
                                }
                            },
                            "C:\\inforbc\\log\\initscript.log": {
                                "content": "*****************initscript******************************"
                            },
                            "C:\\inforbc\\tmp\\Saltminion.exe": {
                                "source": "http://inforbusinesscloud.s3.amazonaws.com/Softwares/SaltMinion/Salt-Minion-2014.1.7-AMD64-Setup.exe"
                            }
                        },
                        "commands": {
                            "1-salt-install": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "sc stop salt-minion & timeout 10 & RD /S /Q c:\\salt & timeout 10 & C:\\inforbc\\tmp\\Saltminion.exe /S /master=salt-mark.epiengcloud.com /minion-name=WFM-INFORBCJMP01-",
                                            {
                                                "Ref": "prefix"
                                            },
                                            "-",
                                            {
                                                "Ref": "VPC"
                                            },
                                            " & timeout 15 & copy c:\\Windows\\cwi\\grains c:\\salt\\conf\\grains & timeout 10"
                                        ]
                                    ]
                                },
                                "cwd": "c:\\inforbc\\tmp\\",
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "10"
                            },
                            "2-rename": {
                                "command": "C:\\salt\\salt-call.exe --local system.set_computer_name 'INFORBCJMP01'"
                            },
                            "3-reboot": {
                                "command": "C:\\salt\\salt-call.exe --local system.reboot",
                                "waitAfterCompletion": "forever"
                            },
                            "8-saltgrainsMasterServer": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval MasterServer https://cops.cloudsuite.infor.com"
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "81-saltgrainsagentGuid": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval agentGuid 9bd91216-a600-46ef-b492-5ed4959b2d8a"
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "82-saltgrainsScenarioId": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval ScenarioId 13847"
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "83-saltgrainsVersion": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval version ",
                                            {
                                                "Ref": "version"
                                            }
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "84-saltgrainsCustPrefix": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval CustPrefix ",
                                            {
                                                "Ref": "prefix"
                                            }
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "841-saltgrainsVPCId": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval vpcId ",
                                            {
                                                "Ref": "VPC"
                                            }
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "842-saltgrainsVPCCIDR": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval VPCCIDR ",
                                            {
                                                "Ref": "VPCCIDR"
                                            }
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "843-saltgrainsawsregion": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval awsregion ",
                                            {
                                                "Ref": "AWS::Region"
                                            }
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "844-saltgrainsCustPrefix": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval shortName ",
                                            {
                                                "Ref": "shortName"
                                            }
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "845-saltgrainsCustPrefix": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval dbsid ",
                                            {
                                                "Ref": "dbsid"
                                            }
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "846-saltgrainsCustPrefix": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval envType ",
                                            {
                                                "Ref": "envType"
                                            }
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "85-saltgrainsSuitename": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "C:\\salt\\salt-call.exe grains.setval suitename wfm"
                                        ]
                                    ]
                                },
                                "ignoreErrors": "true",
                                "waitAfterCompletion": "2"
                            },
                            "851-saltkeepalive": {
                                "command": {
                                    "Fn::Join": [
                                        "",
                                        [
                                            "( echo tcp_keepalive: True & echo tcp_keepalive_idle: 300 & echo tcp_keepalive_cnt: 3 & echo tcp_keepalive_intvl: 60 ) >> C:\\salt\\conf\\minion"
                                        ]
                                    ]
                                },
                                "waitAfterCompletion": "2"
                            },
                            "86-stop-slat-minion": {
                                "command": "sc stop salt-minion",
                                "cwd": "C:\\",
                                "waitAfterCompletion": "2"
                            },
                            "87-start-slat-minion": {
                                "command": "sc start salt-minion",
                                "cwd": "C:\\",
                                "waitAfterCompletion": "2"
                            },
                            "88-highstate": {
                                "command": "C:\\salt\\salt-call.exe state.highstate",
                                "ignoreErrors": "true"
                            }
                        }
                    }
                }
            },
            "Properties": {
                "ImageId": {
                    "Fn::FindInMap": [
                        "INFORBCJMP01",
                        {
                            "Ref": "AWS::Region"
                        },
                        "AMI"
                    ]
                },
                "SecurityGroupIds": [
                    {
                        "Ref": "INFORBCJMP01SecurityGroup"
                    }
                ],
                "SubnetId": {
                    "Ref": "Private4Subnet"
                },
                "InstanceType": {
                    "Ref": "INFORBCJMP01Type"
                },
                "PrivateIpAddress": {
                    "Fn::FindInMap": [
                        "PrivateIp",
                        "JMP",
                        "Address"
                    ]
                },
                "KeyName": {
                    "Ref": "KeyName"
                },
                "DisableApiTermination": {
                    "Ref": "TerminationONOFF"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                {
                                                    "Ref": "prefix"
                                                }
                                            ]
                                        ]
                                    },
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "-INFORBCJMP01"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    },
                    {
                        "Key": "machineLabel",
                        "Value": "INFORBCJMP01"
                    },
                    {
                        "Key": "agentGuid",
                        "Value": "9bd91216-a600-46ef-b492-5ed4959b2d8a"
                    }
                ],
                "IamInstanceProfile": {
                    "Ref": "RootInstanceProfile"
                },
                "BlockDeviceMappings": [
                    {
                        "DeviceName": "/dev/sda1",
                        "Ebs": {
                            "VolumeSize": "50",
                            "VolumeType": "gp2"
                        }
                    }
                ],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": [
                            "",
                            [
                                "<script>\n",
                                "cfn-init.exe -v -s ",
                                {
                                    "Ref": "AWS::StackId"
                                },
                                " -r INFORBCJMP01Instance",
                                " --region ",
                                {
                                    "Ref": "AWS::Region"
                                },
                                "\n",
                                "</script>"
                            ]
                        ]
                    }
                }
            }
        },
        "INFORBCJMP01SecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "customerPrefix",
                        "Value": {
                            "Ref": "prefix"
                        }
                    },
                    {
                        "Key": "Name",
                        "Value": {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::Join": [
                                            "",
                                            [
                                                "cs-wfm-00-prd-INFORBCJMP01SecurityGroup"
                                            ]
                                        ]
                                    }
                                ]
                            ]
                        }
                    },
                    {
                        "Key": "Application",
                        "Value": {
                            "Ref": "AWS::StackId"
                        }
                    }
                ],
                "GroupDescription": "INFORBCJMP01 Server Security Group",
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "9581",
                        "ToPort": "9581",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "icmp",
                        "FromPort": "-1",
                        "ToPort": "-1",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "3389",
                        "ToPort": "3389",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "6556",
                        "ToPort": "6556",
                        "CidrIp": {
                            "Fn::FindInMap": [
                                "SubnetConfig",
                                "VPC",
                                "CIDR"
                            ]
                        }
                    }
                ]
            }
        }
    },
    "Outputs": {
        "ELBINFORBCWS01Route53Inputs": {
            "Value": {
                "Fn::Join": [
                    "",
                    [
                        {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Ref": "prefix"
                                    }
                                ]
                            ]
                        },
                        {
                            "Fn::Join": [
                                "",
                                [
                                    "|CNAME|"
                                ]
                            ]
                        },
                        {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Fn::GetAtt": [
                                            "INFORBCWSElasticLoadBalancer",
                                            "DNSName"
                                        ]
                                    }
                                ]
                            ]
                        },
                        {
                            "Fn::Join": [
                                "",
                                [
                                    "|"
                                ]
                            ]
                        },
                        {
                            "Fn::Join": [
                                "",
                                [
                                    {
                                        "Ref": "HostedZone"
                                    }
                                ]
                            ]
                        }
                    ]
                ]
            },
            "Description": "Route 53 Inputs formate as: CustomerPrefix|Type|ServerElasticIPAddress|DomainName. Example: BBC-ws01|CNAME|Cloudsuite-WFM-QADWSPFAG56P-30343908.eu-west-1.elb.amazonaws.com|cloud.infor.com"
        },
        "InstallCustprefix": {
            "Value": {
                "Ref": "prefix"
            },
            "Description": "Infor CloudSuite WFM PRODUCT Installed Customer Prefix."
        }
    }
}